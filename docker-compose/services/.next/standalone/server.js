const path = require('path')

const dir = path.join(__dirname)

process.env.NODE_ENV = 'production'
process.chdir(__dirname)

// Make sure commands gracefully respect termination signals (e.g. from Docker)
// Allow the graceful termination to be manually configurable
if (!process.env.NEXT_MANUAL_SIG_HANDLE) {
  process.on('SIGTERM', () => process.exit(0))
  process.on('SIGINT', () => process.exit(0))
}

const currentPort = parseInt(process.env.PORT, 10) || 3000
const hostname = process.env.HOSTNAME || '0.0.0.0'

let keepAliveTimeout = parseInt(process.env.KEEP_ALIVE_TIMEOUT, 10)
const nextConfig = {"env":{},"eslint":{"ignoreDuringBuilds":false},"typescript":{"ignoreBuildErrors":false,"tsconfigPath":"tsconfig.json"},"distDir":"./.next","cleanDistDir":true,"assetPrefix":"","configOrigin":"next.config.js","useFileSystemPublicRoutes":true,"generateEtags":true,"pageExtensions":["tsx","ts","jsx","js"],"poweredByHeader":true,"compress":true,"analyticsId":"","images":{"deviceSizes":[640,750,828,1080,1200,1920,2048,3840],"imageSizes":[16,32,48,64,96,128,256,384],"path":"/_next/image","loader":"default","loaderFile":"","domains":[],"disableStaticImages":false,"minimumCacheTTL":60,"formats":["image/webp"],"dangerouslyAllowSVG":false,"contentSecurityPolicy":"script-src 'none'; frame-src 'none'; sandbox;","contentDispositionType":"inline","remotePatterns":[],"unoptimized":false},"devIndicators":{"buildActivity":true,"buildActivityPosition":"bottom-right"},"onDemandEntries":{"maxInactiveAge":60000,"pagesBufferLength":5},"amp":{"canonicalBase":""},"basePath":"","sassOptions":{},"trailingSlash":false,"i18n":null,"productionBrowserSourceMaps":true,"optimizeFonts":true,"excludeDefaultMomentLocales":true,"serverRuntimeConfig":{},"publicRuntimeConfig":{},"reactProductionProfiling":false,"reactStrictMode":true,"httpAgentOptions":{"keepAlive":true},"outputFileTracing":true,"staticPageGenerationTimeout":60,"swcMinify":true,"output":"standalone","modularizeImports":{"@mui/icons-material":{"transform":"@mui/icons-material/{{member}}"},"date-fns":{"transform":"date-fns/{{member}}"},"lodash":{"transform":"lodash/{{member}}"},"lodash-es":{"transform":"lodash-es/{{member}}"},"ramda":{"transform":"ramda/es/{{member}}"},"react-bootstrap":{"transform":{"useAccordionButton":"modularize-import-loader?name=useAccordionButton&from=named&as=default!react-bootstrap/AccordionButton","*":"react-bootstrap/{{member}}"}},"antd":{"transform":"antd/lib/{{kebabCase member}}"},"ahooks":{"transform":{"createUpdateEffect":"modularize-import-loader?name=createUpdateEffect&from=named&as=default!ahooks/es/createUpdateEffect","*":"ahooks/es/{{member}}"}},"@ant-design/icons":{"transform":{"IconProvider":"modularize-import-loader?name=IconProvider&from=named&as=default!@ant-design/icons","createFromIconfontCN":"@ant-design/icons/es/components/IconFont","getTwoToneColor":"modularize-import-loader?name=getTwoToneColor&from=named&as=default!@ant-design/icons/es/components/twoTonePrimaryColor","setTwoToneColor":"modularize-import-loader?name=setTwoToneColor&from=named&as=default!@ant-design/icons/es/components/twoTonePrimaryColor","*":"@ant-design/icons/lib/icons/{{member}}"}},"next/server":{"transform":"next/dist/server/web/exports/{{ kebabCase member }}"}},"experimental":{"serverMinification":true,"serverSourceMaps":false,"caseSensitiveRoutes":false,"useDeploymentId":false,"useDeploymentIdServerActions":false,"clientRouterFilter":true,"clientRouterFilterRedirects":false,"fetchCacheKeyPrefix":"","middlewarePrefetch":"flexible","optimisticClientCache":true,"manualClientBasePath":false,"cpus":11,"memoryBasedWorkersCount":false,"isrFlushToDisk":true,"workerThreads":false,"optimizeCss":false,"nextScriptWorkers":false,"scrollRestoration":false,"externalDir":false,"disableOptimizedLoading":false,"gzipSize":true,"craCompat":false,"esmExternals":true,"isrMemoryCacheSize":52428800,"fullySpecified":false,"outputFileTracingRoot":"/Users/yzw/Downloads/frontend","swcTraceProfiling":false,"forceSwcTransforms":false,"largePageDataBytes":128000,"adjustFontFallbacks":false,"adjustFontFallbacksWithSizeAdjust":false,"typedRoutes":false,"instrumentationHook":true,"bundlePagesExternals":false,"optimizePackageImports":["lucide-react","@headlessui/react","@headlessui-float/react","@heroicons/react/20/solid","@heroicons/react/24/solid","@heroicons/react/24/outline","@visx/visx","@tremor/react","rxjs","@mui/material","recharts","@material-ui/core","react-use","@material-ui/icons","@tabler/icons-react","mui-core","react-icons/ai","react-icons/bi","react-icons/bs","react-icons/cg","react-icons/ci","react-icons/di","react-icons/fa","react-icons/fa6","react-icons/fc","react-icons/fi","react-icons/gi","react-icons/go","react-icons/gr","react-icons/hi","react-icons/hi2","react-icons/im","react-icons/io","react-icons/io5","react-icons/lia","react-icons/lib","react-icons/lu","react-icons/md","react-icons/pi","react-icons/ri","react-icons/rx","react-icons/si","react-icons/sl","react-icons/tb","react-icons/tfi","react-icons/ti","react-icons/vsc","react-icons/wi"],"trustHostHeader":false,"isExperimentalCompile":true},"configFileName":"next.config.js","transpilePackages":["react-syntax-highlighter","swagger-client","swagger-ui-react"],"_originalRewrites":{"beforeFiles":[],"afterFiles":[{"source":"/node-api/proxy/:slug*","destination":"/api/proxy"},{"source":"/node-api/:slug*","destination":"/api/:slug*"}],"fallback":[]},"_originalRedirects":[{"source":"/account/tag_address","destination":"/account/tag-address","permanent":false},{"source":"/account/tag_address/new","destination":"/account/tag-address","permanent":false},{"source":"/account/tag_transaction","destination":"/account/tag-address?tab=tx","permanent":false},{"source":"/account/tag_transaction/new","destination":"/account/tag-address?tab=tx","permanent":false},{"source":"/account/watchlist_address/:id/edit","destination":"/account/watchlist","permanent":false},{"source":"/account/watchlist_address/new","destination":"/account/watchlist","permanent":false},{"source":"/account/api_key","destination":"/account/api-key","permanent":false},{"source":"/account/api_key/:id/edit","destination":"/account/api-key","permanent":false},{"source":"/account/api_key/new","destination":"/account/api-key","permanent":false},{"source":"/account/custom_abi","destination":"/account/custom-abi","permanent":false},{"source":"/account/custom_abi/:id/edit","destination":"/account/custom-abi","permanent":false},{"source":"/account/custom_abi/new","destination":"/account/custom-abi","permanent":false},{"source":"/account/public_tags_request","destination":"/account/public-tags-request","permanent":false},{"source":"/account/public_tags_request/:id/edit","destination":"/account/public-tags-request","permanent":false},{"source":"/account/public_tags_request/new","destination":"/account/public-tags-request","permanent":false},{"source":"/pending-transactions","destination":"/txs?tab=pending","permanent":false},{"source":"/tx/:hash/internal-transactions","destination":"/tx/:hash?tab=internal","permanent":false},{"source":"/tx/:hash/logs","destination":"/tx/:hash?tab=logs","permanent":false},{"source":"/tx/:hash/raw-trace","destination":"/tx/:hash?tab=raw_trace","permanent":false},{"source":"/tx/:hash/state","destination":"/tx/:hash?tab=state","permanent":false},{"source":"/tx/:hash/token-transfers","destination":"/tx/:hash?tab=token_transfers","permanent":false},{"source":"/blocks/:height/:path*","destination":"/block/:height/:path*","permanent":false},{"source":"/uncles","destination":"/blocks?tab=uncles","permanent":false},{"source":"/reorgs","destination":"/blocks?tab=reorgs","permanent":false},{"source":"/block/:height/transactions","destination":"/block/:height?tab=txs","permanent":false},{"source":"/block/:height/withdrawals","destination":"/block/:height?tab=withdrawals","permanent":false},{"source":"/address/:hash/transactions","destination":"/address/:hash","permanent":false},{"source":"/address/:hash/token-transfers","destination":"/address/:hash?tab=token_transfers","permanent":false},{"source":"/address/:hash/tokens","destination":"/address/:hash?tab=tokens","permanent":false},{"source":"/address/:hash/internal-transactions","destination":"/address/:hash?tab=internal_txns","permanent":false},{"source":"/address/:hash/coin-balances","destination":"/address/:hash?tab=coin_balance_history","permanent":false},{"source":"/address/:hash/logs","destination":"/address/:hash?tab=logs","permanent":false},{"source":"/address/:hash/validations","destination":"/address/:hash?tab=blocks_validated","permanent":false},{"source":"/address/:hash/contracts","destination":"/address/:hash?tab=contract","permanent":false},{"source":"/address/:hash/read-contract","destination":"/address/:hash?tab=read_contract","permanent":false},{"source":"/address/:hash/read-proxy","destination":"/address/:hash?tab=read_proxy","permanent":false},{"source":"/address/:hash/write-contract","destination":"/address/:hash?tab=write_contract","permanent":false},{"source":"/address/:hash/write-proxy","destination":"/address/:hash?tab=write_proxy","permanent":false},{"source":"/address/:hash/tokens/:token_hash/token-transfers","destination":"/address/:hash?tab=token_transfers&token=:token_hash","permanent":false},{"source":"/address/:hash/contract_verifications/new","destination":"/address/:hash/contract_verification","permanent":false},{"source":"/address/:hash/verify-via-flattened-code/new","destination":"/address/:hash/contract_verification?method=flatten_source_code","permanent":false},{"source":"/address/:hash/verify-via-standard-json-input/new","destination":"/address/:hash/contract_verification?method=standard_input","permanent":false},{"source":"/address/:hash/verify-via-metadata-json/new","destination":"/address/:hash/contract_verification?method=sourcify","permanent":false},{"source":"/address/:hash/verify-via-multi-part-files/new","destination":"/address/:hash/contract_verification?method=multi_part_file","permanent":false},{"source":"/address/:hash/verify-vyper-contract/new","destination":"/address/:hash/contract_verification?method=vyper_contract","permanent":false},{"source":"/bridged-tokens","destination":"/tokens/?tab=bridged","permanent":false},{"source":"/bridged-tokens/:chain_name","destination":"/tokens/?tab=bridged","permanent":false},{"source":"/tokens/:hash/:path*","destination":"/token/:hash/:path*","permanent":false},{"source":"/token/:hash/token-transfers","destination":"/token/:hash/?tab=token_transfers","permanent":false},{"source":"/token/:hash/token-holders","destination":"/token/:hash/?tab=holders","permanent":false},{"source":"/token/:hash/inventory","destination":"/token/:hash/?tab=inventory","permanent":false},{"source":"/token/:hash/instance/:id/token-transfers","destination":"/token/:hash/instance/:id","permanent":false},{"source":"/token/:hash/instance/:id/token-holders","destination":"/token/:hash/instance/:id?tab=holders","permanent":false},{"source":"/token/:hash/instance/:id/metadata","destination":"/token/:hash/instance/:id?tab=metadata","permanent":false},{"source":"/token/:hash/read-contract","destination":"/token/:hash?tab=read_contract","permanent":false},{"source":"/token/:hash/read-proxy","destination":"/token/:hash?tab=read_proxy","permanent":false},{"source":"/token/:hash/write-contract","destination":"/token/:hash?tab=write_contract","permanent":false},{"source":"/token/:hash/write-proxy","destination":"/token/:hash?tab=write_proxy","permanent":false}]}

process.env.__NEXT_PRIVATE_STANDALONE_CONFIG = JSON.stringify(nextConfig)

require('next')
const { startServer } = require('next/dist/server/lib/start-server')

if (
  Number.isNaN(keepAliveTimeout) ||
  !Number.isFinite(keepAliveTimeout) ||
  keepAliveTimeout < 0
) {
  keepAliveTimeout = undefined
}

startServer({
  dir,
  isDev: false,
  config: nextConfig,
  hostname,
  port: currentPort,
  allowRetry: false,
  keepAliveTimeout,
  useWorkers: true,
}).catch((err) => {
  console.error(err);
  process.exit(1);
});