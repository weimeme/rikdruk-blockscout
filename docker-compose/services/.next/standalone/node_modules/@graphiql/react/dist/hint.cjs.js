"use strict";var G=Object.defineProperty;var m=(t,o)=>G(t,"name",{value:o,configurable:!0});var _=require("./codemirror.cjs.js");require("./show-hint.cjs.js");var l=require("graphql"),i=require("./types.cjs.js"),M=require("./Range.cjs.js"),K=require("./introspection.cjs.js");require("./index.cjs.js");require("react");require("react-dom");function V(t){let o;return U(t,r=>{switch(r.kind){case"Query":case"ShortQuery":case"Mutation":case"Subscription":case"FragmentDefinition":o=r;break}}),o}m(V,"getDefinitionState");function h(t,o,r){return r===K.SchemaMetaFieldDef.name&&t.getQueryType()===o?K.SchemaMetaFieldDef:r===K.TypeMetaFieldDef.name&&t.getQueryType()===o?K.TypeMetaFieldDef:r===K.TypeNameMetaFieldDef.name&&l.isCompositeType(o)?K.TypeNameMetaFieldDef:"getFields"in o?o.getFields()[r]:null}m(h,"getFieldDef");function U(t,o){const r=[];let n=t;for(;n!=null&&n.kind;)r.push(n),n=n.prevState;for(let e=r.length-1;e>=0;e--)o(r[e])}m(U,"forEachState");function S(t){const o=Object.keys(t),r=o.length,n=new Array(r);for(let e=0;e<r;++e)n[e]=t[o[e]];return n}m(S,"objectValues");function R(t,o){return B(o,j(t.string))}m(R,"hintList");function B(t,o){if(!o)return O(t,n=>!n.isDeprecated);const r=t.map(n=>({proximity:Q(j(n.label),o),entry:n}));return O(O(r,n=>n.proximity<=2),n=>!n.entry.isDeprecated).sort((n,e)=>(n.entry.isDeprecated?1:0)-(e.entry.isDeprecated?1:0)||n.proximity-e.proximity||n.entry.label.length-e.entry.label.length).map(n=>n.entry)}m(B,"filterAndSortList");function O(t,o){const r=t.filter(o);return r.length===0?t:r}m(O,"filterNonEmpty");function j(t){return t.toLowerCase().replace(/\W/g,"")}m(j,"normalizeText");function Q(t,o){let r=w(o,t);return t.length>o.length&&(r-=t.length-o.length-1,r+=t.indexOf(o)===0?0:.5),r}m(Q,"getProximity");function w(t,o){let r,n;const e=[],d=t.length,a=o.length;for(r=0;r<=d;r++)e[r]=[r];for(n=1;n<=a;n++)e[0][n]=n;for(r=1;r<=d;r++)for(n=1;n<=a;n++){const c=t[r-1]===o[n-1]?0:1;e[r][n]=Math.min(e[r-1][n]+1,e[r][n-1]+1,e[r-1][n-1]+c),r>1&&n>1&&t[r-1]===o[n-2]&&t[r-2]===o[n-1]&&(e[r][n]=Math.min(e[r][n],e[r-2][n-2]+c))}return e[d][a]}m(w,"lexicalDistance");const P={command:"editor.action.triggerSuggest",title:"Suggestions"},Y=m(t=>{const o=[];if(t)try{l.visit(l.parse(t),{FragmentDefinition(r){o.push(r)}})}catch{return[]}return o},"collectFragmentDefs");function J(t,o,r,n,e,d){var a;const c=Object.assign(Object.assign({},d),{schema:t}),s=n||ie(o,r),u=s.state.kind==="Invalid"?s.state.prevState:s.state;if(!u)return[];const f=u.kind,E=u.step,y=oe(t,s.state);if(f===i.RuleKinds.DOCUMENT)return R(s,[{label:"query",kind:i.CompletionItemKind.Function},{label:"mutation",kind:i.CompletionItemKind.Function},{label:"subscription",kind:i.CompletionItemKind.Function},{label:"fragment",kind:i.CompletionItemKind.Function},{label:"{",kind:i.CompletionItemKind.Constructor}]);if(f===i.RuleKinds.IMPLEMENTS||f===i.RuleKinds.NAMED_TYPE&&((a=u.prevState)===null||a===void 0?void 0:a.kind)===i.RuleKinds.IMPLEMENTS)return z(s,u,t,o,y);if(f===i.RuleKinds.SELECTION_SET||f===i.RuleKinds.FIELD||f===i.RuleKinds.ALIASED_FIELD)return $(s,y,c);if(f===i.RuleKinds.ARGUMENTS||f===i.RuleKinds.ARGUMENT&&E===0){const p=y.argDefs;if(p)return R(s,p.map(T=>{var v;return{label:T.name,insertText:T.name+": ",command:P,detail:String(T.type),documentation:(v=T.description)!==null&&v!==void 0?v:void 0,kind:i.CompletionItemKind.Variable,type:T.type}}))}if((f===i.RuleKinds.OBJECT_VALUE||f===i.RuleKinds.OBJECT_FIELD&&E===0)&&y.objectFieldDefs){const p=S(y.objectFieldDefs),T=f===i.RuleKinds.OBJECT_VALUE?i.CompletionItemKind.Value:i.CompletionItemKind.Field;return R(s,p.map(v=>{var I;return{label:v.name,detail:String(v.type),documentation:(I=v.description)!==null&&I!==void 0?I:void 0,kind:T,type:v.type}}))}if(f===i.RuleKinds.ENUM_VALUE||f===i.RuleKinds.LIST_VALUE&&E===1||f===i.RuleKinds.OBJECT_FIELD&&E===2||f===i.RuleKinds.ARGUMENT&&E===2)return H(s,y,o,t);if(f===i.RuleKinds.VARIABLE&&E===1){const p=l.getNamedType(y.inputType),T=x(o,t,s);return R(s,T.filter(v=>v.detail===(p==null?void 0:p.name)))}return f===i.RuleKinds.TYPE_CONDITION&&E===1||f===i.RuleKinds.NAMED_TYPE&&u.prevState!=null&&u.prevState.kind===i.RuleKinds.TYPE_CONDITION?W(s,y,t):f===i.RuleKinds.FRAGMENT_SPREAD&&E===1?X(s,y,t,o,Array.isArray(e)?e:Y(e)):f===i.RuleKinds.VARIABLE_DEFINITION&&E===2||f===i.RuleKinds.LIST_TYPE&&E===1||f===i.RuleKinds.NAMED_TYPE&&u.prevState&&(u.prevState.kind===i.RuleKinds.VARIABLE_DEFINITION||u.prevState.kind===i.RuleKinds.LIST_TYPE||u.prevState.kind===i.RuleKinds.NON_NULL_TYPE)?ne(s,t):f===i.RuleKinds.DIRECTIVE?te(s,u,t):[]}m(J,"getAutocompleteSuggestions");const L=` {
  $1
}`,q=m(t=>{const o=t.type;return l.isCompositeType(o)||l.isListType(o)&&l.isCompositeType(o.ofType)||l.isNonNullType(o)&&(l.isCompositeType(o.ofType)||l.isListType(o.ofType)&&l.isCompositeType(o.ofType.ofType))?L:null},"getInsertText");function $(t,o,r){var n;if(o.parentType){const e=o.parentType;let d=[];return"getFields"in e&&(d=S(e.getFields())),l.isCompositeType(e)&&d.push(l.TypeNameMetaFieldDef),e===((n=r==null?void 0:r.schema)===null||n===void 0?void 0:n.getQueryType())&&d.push(l.SchemaMetaFieldDef,l.TypeMetaFieldDef),R(t,d.map((a,c)=>{var s;const u={sortText:String(c)+a.name,label:a.name,detail:String(a.type),documentation:(s=a.description)!==null&&s!==void 0?s:void 0,deprecated:Boolean(a.deprecationReason),isDeprecated:Boolean(a.deprecationReason),deprecationReason:a.deprecationReason,kind:i.CompletionItemKind.Field,type:a.type},f=q(a);return f&&(u.insertText=a.name+f,u.insertTextFormat=i.InsertTextFormat.Snippet,u.command=P),u}))}return[]}m($,"getSuggestionsForFieldNames");function H(t,o,r,n){const e=l.getNamedType(o.inputType),d=x(r,n,t).filter(a=>a.detail===e.name);if(e instanceof l.GraphQLEnumType){const a=e.getValues();return R(t,a.map(c=>{var s;return{label:c.name,detail:String(e),documentation:(s=c.description)!==null&&s!==void 0?s:void 0,deprecated:Boolean(c.deprecationReason),isDeprecated:Boolean(c.deprecationReason),deprecationReason:c.deprecationReason,kind:i.CompletionItemKind.EnumMember,type:e}}).concat(d))}else if(e===l.GraphQLBoolean)return R(t,d.concat([{label:"true",detail:String(l.GraphQLBoolean),documentation:"Not false.",kind:i.CompletionItemKind.Variable,type:l.GraphQLBoolean},{label:"false",detail:String(l.GraphQLBoolean),documentation:"Not true.",kind:i.CompletionItemKind.Variable,type:l.GraphQLBoolean}]));return d}m(H,"getSuggestionsForInputValues");function z(t,o,r,n,e){if(o.needsSeperator)return[];const d=r.getTypeMap(),a=S(d).filter(l.isInterfaceType),c=a.map(({name:p})=>p),s=new Set;C(n,(p,T)=>{var v,I,N,D,g;if(T.name&&(T.kind===i.RuleKinds.INTERFACE_DEF&&!c.includes(T.name)&&s.add(T.name),T.kind===i.RuleKinds.NAMED_TYPE&&((v=T.prevState)===null||v===void 0?void 0:v.kind)===i.RuleKinds.IMPLEMENTS)){if(e.interfaceDef){if((I=e.interfaceDef)===null||I===void 0?void 0:I.getInterfaces().find(({name:A})=>A===T.name))return;const k=r.getType(T.name),F=(N=e.interfaceDef)===null||N===void 0?void 0:N.toConfig();e.interfaceDef=new l.GraphQLInterfaceType(Object.assign(Object.assign({},F),{interfaces:[...F.interfaces,k||new l.GraphQLInterfaceType({name:T.name,fields:{}})]}))}else if(e.objectTypeDef){if((D=e.objectTypeDef)===null||D===void 0?void 0:D.getInterfaces().find(({name:A})=>A===T.name))return;const k=r.getType(T.name),F=(g=e.objectTypeDef)===null||g===void 0?void 0:g.toConfig();e.objectTypeDef=new l.GraphQLObjectType(Object.assign(Object.assign({},F),{interfaces:[...F.interfaces,k||new l.GraphQLInterfaceType({name:T.name,fields:{}})]}))}}});const u=e.interfaceDef||e.objectTypeDef,E=((u==null?void 0:u.getInterfaces())||[]).map(({name:p})=>p),y=a.concat([...s].map(p=>({name:p}))).filter(({name:p})=>p!==(u==null?void 0:u.name)&&!E.includes(p));return R(t,y.map(p=>{const T={label:p.name,kind:i.CompletionItemKind.Interface,type:p};return p!=null&&p.description&&(T.documentation=p.description),T}))}m(z,"getSuggestionsForImplements");function W(t,o,r,n){let e;if(o.parentType)if(l.isAbstractType(o.parentType)){const d=l.assertAbstractType(o.parentType),a=r.getPossibleTypes(d),c=Object.create(null);a.forEach(s=>{s.getInterfaces().forEach(u=>{c[u.name]=u})}),e=a.concat(S(c))}else e=[o.parentType];else{const d=r.getTypeMap();e=S(d).filter(l.isCompositeType)}return R(t,e.map(d=>{const a=l.getNamedType(d);return{label:String(d),documentation:(a==null?void 0:a.description)||"",kind:i.CompletionItemKind.Field}}))}m(W,"getSuggestionsForFragmentTypeConditions");function X(t,o,r,n,e){if(!n)return[];const d=r.getTypeMap(),a=V(t.state),c=ee(n);e&&e.length>0&&c.push(...e);const s=c.filter(u=>d[u.typeCondition.name.value]&&!(a&&a.kind===i.RuleKinds.FRAGMENT_DEFINITION&&a.name===u.name.value)&&l.isCompositeType(o.parentType)&&l.isCompositeType(d[u.typeCondition.name.value])&&l.doTypesOverlap(r,o.parentType,d[u.typeCondition.name.value]));return R(t,s.map(u=>({label:u.name.value,detail:String(d[u.typeCondition.name.value]),documentation:`fragment ${u.name.value} on ${u.typeCondition.name.value}`,kind:i.CompletionItemKind.Field,type:d[u.typeCondition.name.value]})))}m(X,"getSuggestionsForFragmentSpread");const Z=m((t,o)=>{var r,n,e,d,a,c,s,u,f,E;if(((r=t.prevState)===null||r===void 0?void 0:r.kind)===o)return t.prevState;if(((e=(n=t.prevState)===null||n===void 0?void 0:n.prevState)===null||e===void 0?void 0:e.kind)===o)return t.prevState.prevState;if(((c=(a=(d=t.prevState)===null||d===void 0?void 0:d.prevState)===null||a===void 0?void 0:a.prevState)===null||c===void 0?void 0:c.kind)===o)return t.prevState.prevState.prevState;if(((E=(f=(u=(s=t.prevState)===null||s===void 0?void 0:s.prevState)===null||u===void 0?void 0:u.prevState)===null||f===void 0?void 0:f.prevState)===null||E===void 0?void 0:E.kind)===o)return t.prevState.prevState.prevState.prevState},"getParentDefinition");function x(t,o,r){let n=null,e;const d=Object.create({});return C(t,(a,c)=>{if((c==null?void 0:c.kind)===i.RuleKinds.VARIABLE&&c.name&&(n=c.name),(c==null?void 0:c.kind)===i.RuleKinds.NAMED_TYPE&&n){const s=Z(c,i.RuleKinds.TYPE);s!=null&&s.type&&(e=o.getType(s==null?void 0:s.type))}n&&e&&(d[n]||(d[n]={detail:e.toString(),insertText:r.string==="$"?n:"$"+n,label:n,type:e,kind:i.CompletionItemKind.Variable},n=null,e=null))}),S(d)}m(x,"getVariableCompletions");function ee(t){const o=[];return C(t,(r,n)=>{n.kind===i.RuleKinds.FRAGMENT_DEFINITION&&n.name&&n.type&&o.push({kind:i.RuleKinds.FRAGMENT_DEFINITION,name:{kind:l.Kind.NAME,value:n.name},selectionSet:{kind:i.RuleKinds.SELECTION_SET,selections:[]},typeCondition:{kind:i.RuleKinds.NAMED_TYPE,name:{kind:l.Kind.NAME,value:n.type}}})}),o}m(ee,"getFragmentDefinitions");function ne(t,o,r){const n=o.getTypeMap(),e=S(n).filter(l.isInputType);return R(t,e.map(d=>({label:d.name,documentation:d.description,kind:i.CompletionItemKind.Variable})))}m(ne,"getSuggestionsForVariableDefinition");function te(t,o,r,n){var e;if(!((e=o.prevState)===null||e===void 0)&&e.kind){const d=r.getDirectives().filter(a=>re(o.prevState,a));return R(t,d.map(a=>({label:a.name,documentation:a.description||"",kind:i.CompletionItemKind.Function})))}return[]}m(te,"getSuggestionsForDirective");function ie(t,o){let r=null,n=null,e=null;const d=C(t,(a,c,s,u)=>{if(u===o.line&&a.getCurrentPosition()>=o.character)return r=s,n=Object.assign({},c),e=a.current(),"BREAK"});return{start:d.start,end:d.end,string:e||d.string,state:n||d.state,style:r||d.style}}m(ie,"getTokenAtPosition");function C(t,o){const r=t.split(`
`),n=i.onlineParser();let e=n.startState(),d="",a=new M.CharacterStream("");for(let c=0;c<r.length;c++){for(a=new M.CharacterStream(r[c]);!a.eol()&&(d=n.token(a,e),o(a,e,d,c)!=="BREAK"););o(a,e,d,c),e.kind||(e=n.startState())}return{start:a.getStartOfToken(),end:a.getCurrentPosition(),string:a.current(),state:e,style:d}}m(C,"runOnlineParser");function re(t,o){var r;if(!t||!t.kind)return!1;const n=t.kind,e=o.locations;switch(n){case i.RuleKinds.QUERY:return e.indexOf(l.DirectiveLocation.QUERY)!==-1;case i.RuleKinds.MUTATION:return e.indexOf(l.DirectiveLocation.MUTATION)!==-1;case i.RuleKinds.SUBSCRIPTION:return e.indexOf(l.DirectiveLocation.SUBSCRIPTION)!==-1;case i.RuleKinds.FIELD:case i.RuleKinds.ALIASED_FIELD:return e.indexOf(l.DirectiveLocation.FIELD)!==-1;case i.RuleKinds.FRAGMENT_DEFINITION:return e.indexOf(l.DirectiveLocation.FRAGMENT_DEFINITION)!==-1;case i.RuleKinds.FRAGMENT_SPREAD:return e.indexOf(l.DirectiveLocation.FRAGMENT_SPREAD)!==-1;case i.RuleKinds.INLINE_FRAGMENT:return e.indexOf(l.DirectiveLocation.INLINE_FRAGMENT)!==-1;case i.RuleKinds.SCHEMA_DEF:return e.indexOf(l.DirectiveLocation.SCHEMA)!==-1;case i.RuleKinds.SCALAR_DEF:return e.indexOf(l.DirectiveLocation.SCALAR)!==-1;case i.RuleKinds.OBJECT_TYPE_DEF:return e.indexOf(l.DirectiveLocation.OBJECT)!==-1;case i.RuleKinds.FIELD_DEF:return e.indexOf(l.DirectiveLocation.FIELD_DEFINITION)!==-1;case i.RuleKinds.INTERFACE_DEF:return e.indexOf(l.DirectiveLocation.INTERFACE)!==-1;case i.RuleKinds.UNION_DEF:return e.indexOf(l.DirectiveLocation.UNION)!==-1;case i.RuleKinds.ENUM_DEF:return e.indexOf(l.DirectiveLocation.ENUM)!==-1;case i.RuleKinds.ENUM_VALUE:return e.indexOf(l.DirectiveLocation.ENUM_VALUE)!==-1;case i.RuleKinds.INPUT_DEF:return e.indexOf(l.DirectiveLocation.INPUT_OBJECT)!==-1;case i.RuleKinds.INPUT_VALUE_DEF:switch((r=t.prevState)===null||r===void 0?void 0:r.kind){case i.RuleKinds.ARGUMENTS_DEF:return e.indexOf(l.DirectiveLocation.ARGUMENT_DEFINITION)!==-1;case i.RuleKinds.INPUT_DEF:return e.indexOf(l.DirectiveLocation.INPUT_FIELD_DEFINITION)!==-1}}return!1}m(re,"canUseDirective");function oe(t,o){let r,n,e,d,a,c,s,u,f,E,y;return U(o,p=>{var T;switch(p.kind){case i.RuleKinds.QUERY:case"ShortQuery":E=t.getQueryType();break;case i.RuleKinds.MUTATION:E=t.getMutationType();break;case i.RuleKinds.SUBSCRIPTION:E=t.getSubscriptionType();break;case i.RuleKinds.INLINE_FRAGMENT:case i.RuleKinds.FRAGMENT_DEFINITION:p.type&&(E=t.getType(p.type));break;case i.RuleKinds.FIELD:case i.RuleKinds.ALIASED_FIELD:{!E||!p.name?a=null:(a=f?h(t,f,p.name):null,E=a?a.type:null);break}case i.RuleKinds.SELECTION_SET:f=l.getNamedType(E);break;case i.RuleKinds.DIRECTIVE:e=p.name?t.getDirective(p.name):null;break;case i.RuleKinds.INTERFACE_DEF:p.name&&(s=null,y=new l.GraphQLInterfaceType({name:p.name,interfaces:[],fields:{}}));break;case i.RuleKinds.OBJECT_TYPE_DEF:p.name&&(y=null,s=new l.GraphQLObjectType({name:p.name,interfaces:[],fields:{}}));break;case i.RuleKinds.ARGUMENTS:{if(!p.prevState)n=null;else switch(p.prevState.kind){case i.RuleKinds.FIELD:n=a&&a.args;break;case i.RuleKinds.DIRECTIVE:n=e&&e.args;break;case i.RuleKinds.ALIASED_FIELD:{const g=(T=p.prevState)===null||T===void 0?void 0:T.name;if(!g){n=null;break}const b=f?h(t,f,g):null;if(!b){n=null;break}n=b.args;break}default:n=null;break}break}case i.RuleKinds.ARGUMENT:if(n){for(let g=0;g<n.length;g++)if(n[g].name===p.name){r=n[g];break}}c=r==null?void 0:r.type;break;case i.RuleKinds.ENUM_VALUE:const v=l.getNamedType(c);d=v instanceof l.GraphQLEnumType?v.getValues().find(g=>g.value===p.name):null;break;case i.RuleKinds.LIST_VALUE:const I=l.getNullableType(c);c=I instanceof l.GraphQLList?I.ofType:null;break;case i.RuleKinds.OBJECT_VALUE:const N=l.getNamedType(c);u=N instanceof l.GraphQLInputObjectType?N.getFields():null;break;case i.RuleKinds.OBJECT_FIELD:const D=p.name&&u?u[p.name]:null;c=D==null?void 0:D.type;break;case i.RuleKinds.NAMED_TYPE:p.name&&(E=t.getType(p.name));break}}),{argDef:r,argDefs:n,directiveDef:e,enumValue:d,fieldDef:a,inputType:c,objectFieldDefs:u,parentType:f,type:E,interfaceDef:y,objectTypeDef:s}}m(oe,"getTypeInfo");_.CodeMirror.registerHelper("hint","graphql",(t,o)=>{const r=o.schema;if(!r)return;const n=t.getCursor(),e=t.getTokenAt(n),d=e.type!==null&&/"|\w/.test(e.string[0])?e.start:e.end,a=new M.Position(n.line,d),s={list:J(r,t.getValue(),a,e,o.externalFragments).map(u=>({text:u.label,type:u.type,description:u.documentation,isDeprecated:u.isDeprecated,deprecationReason:u.deprecationReason})),from:{line:n.line,ch:d},to:{line:n.line,ch:e.end}};return(s==null?void 0:s.list)&&s.list.length>0&&(s.from=_.CodeMirror.Pos(s.from.line,s.from.ch),s.to=_.CodeMirror.Pos(s.to.line,s.to.ch),_.CodeMirror.signal(t,"hasCompletion",t,s,e)),s});
